# ✅ Kết nối JDBC đến Supabase qua PgBouncer
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# ✅ HikariCP: tối ưu cho nhiều request đồng thời
spring.datasource.hikari.maximumPoolSize=20          # Cho phép 20 kết nối đồng thời
spring.datasource.hikari.minimumIdle=5               # Giữ 5 kết nối nhàn rỗi
spring.datasource.hikari.idleTimeout=600000          # 10 phút trước khi đóng kết nối nhàn rỗi
spring.datasource.hikari.maxLifetime=180000          # 3 phút để tránh bị PgBouncer đóng ngầm
spring.datasource.hikari.connectionTimeout=60000     # Chờ tối đa 60 giây để lấy kết nối
spring.datasource.hikari.connectionTestQuery=SELECT 1

# ✅ Hibernate: tắt caching và batching để tránh lỗi "prepared statement already exists"
spring.jpa.properties.hibernate.statement_cache.size=0
spring.jpa.properties.hibernate.jdbc.batch_size=0
spring.jpa.properties.hibernate.order_inserts=false
spring.jpa.properties.hibernate.order_updates=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# ✅ Hibernate: tự động cập nhật schema nếu cần
spring.jpa.hibernate.ddl-auto=update

# ✅ Bật log để theo dõi SQL và trạng thái pool
logging.level.com.zaxxer.hikari=DEBUG
logging.level.org.hibernate.SQL=DEBUG
